\ProvidesPackage{slideshow}

% create a new file handle
\newwrite\pdfpcnotesfile
\newwrite\notesfile

% open file on \begin{document}
\AtBeginDocument{%
    \immediate\openout\pdfpcnotesfile\jobname.pdfpc\relax
    \immediate\write\pdfpcnotesfile{[notes]}
    \immediate\openout\notesfile\jobname.txt\relax
}
% define a # https://tex.stackexchange.com/a/37757/10327
\begingroup
    \catcode`\#=12
    \gdef\hashchar{#}%
\endgroup
% define command \pnote{} that works exactly like \note but
% additionally writes notes to file in pdfpc readable format
\newcommand{\pnote}[1]{%
    % keep normal notes working
    \note{#1}%
    % write notes to file
    \begingroup
        \let\#\hashchar
        \immediate\write\pdfpcnotesfile{\#\#\# \theframenumber}%
        \immediate\write\pdfpcnotesfile{\unexpanded{#1}}%
        \immediate\write\notesfile{\theframenumber}%
        \immediate\write\notesfile{\unexpanded{#1}}%
    \endgroup
}
% close file on \end{document}
\AtEndDocument{%
    \immediate\closeout\pdfpcnotesfile
    \immediate\closeout\notesfile
}

\usepackage{tabularx}
\renewcommand\tabularxcolumn[1]{m{#1}}   
\usepackage{adjustbox}
\usepackage{multirow}

\usepackage{xcolor}
\definecolor{lightgray}{gray}{0.9}
\definecolor{mylightgrey}{cmyk}{0,0,0,0.1}
\definecolor{myfunblue}{cmyk}{1,.2,.1,.1}
\definecolor{myfungrey}{cmyk}{.05,.05,.01,.01}
\definecolor{mygreen}{cmyk}{1,0,1,0.39}
\definecolor{mylightgreen}{cmyk}{1,0,1,0.09}
\definecolor{mydarkgrey}{cmyk}{.05,.05,.05,.85}
\definecolor{hyperrefLinkColor}{rgb}{0,0.35,0}
\definecolor{hyperrefCiteColor}{rgb}{0.35,0,0.35}
\definecolor{hyperrefURLColor}{rgb}{0,0,0.35}
\definecolor{attachfilecolor}{cmyk}{.1,.2,.3,.4}
\colorlet{accent0}{ProcessBlue}
\colorlet{accent1}{Yellow!20!BurntOrange}
\colorlet{myclozecolor0}{accent0}
\colorlet{myclozecolor1}{accent1}
\colorlet{mytagcolor}{ProcessBlue!30!white}


\usepackage{tikz}
\usepackage{etoolbox}
\usepackage{pgfplots}
\usetikzlibrary{calc,patterns,decorations.pathmorphing,decorations.markings}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{arrows}
\pgfplotsset{compat=1.9}
\usetikzlibrary{backgrounds}
\usepackage{currfile}
\usetikzlibrary{matrix}
\usepgfplotslibrary{groupplots}
% \ifdefined\ishandy
%   % \tikzset{every picture/.append style={transform canvas={scale=.6}}}
%   % \tikzset{transform canvas={scale=.6}}
% \fi
% \usepackage{marginnote}
% \usepackage[strict]{caption}
% \usepackage{l3keys2e}
% \usepackage{changepage}
% \usepackage{sidenotes}

%-- linear graphs

\tikzstyle{groundmech}=
  [
    fill,
    pattern=north east lines,
    draw=none,
    minimum width=0.75cm,
    minimum height=0.3cm
  ]
\tikzstyle{normaltree}=
  [
    color=mygreen,
    very thick
  ]

\def\tf#1#2{
\begin{scope}[shift={#1},scale={#2}]
  \node [draw,
    minimum width=25pt,
    minimum height=10pt,
    thick,dashed,
    line cap=round,
    densely dashed,
    color=violet,
    rounded corners=3pt
  ]
  at (0,0) {};
\end{scope}
}

\def\gy#1#2{
\begin{scope}[shift={#1},scale={#2}]
  \draw [thick,dashed,
  line cap=round,
  densely dashed,
  color=violet,
  rounded corners=10pt]
  (-.2,.22) -- (.2,-.18) -- (.2,.22) -- (-.2,-.18) -- cycle;
\end{scope}
}

%-- circuits

\usepackage[americanvoltages,americancurrents,oldvoltagedirection]{circuitikz}

\tikzset{%
bend angle=30,
branch/.style={=>,thick,postaction={decorate},
decoration={markings,mark=at position 0.5 with {\arrow{>}}},line cap=round},
branchnoarrow/.style={=>,thick,line cap=round},
sourcebranch/.style={thick,postaction={decorate},
decoration={markings,mark=at position 0.55 with {\arrow{>}}},decoration={mark=at position 0.5 with {\draw circle (10pt);}},line cap=round},
sourcebranchnoarrow/.style={thick,postaction={decorate},decoration={markings,mark=at position 0.5 with {\draw circle (10pt);}}},
graphnode/.style={circle,draw=black,fill=lightgray,thick,inner sep=0pt,minimum size=1.5mm,line cap=round},
groundnode/.pic={%
  \draw[thick, line cap=round] (-.25,0) -- (.25,0);
  \draw[thick, line cap=round] (-.15,0) -- ++(-.15,-.15);
  \draw[thick, line cap=round] (-.05,0) -- ++(-.15,-.15);
  \draw[thick, line cap=round] (.05,0) -- ++(-.15,-.15);
  \draw[thick, line cap=round] (.15,0) -- ++(-.15,-.15);
  \draw[thick, line cap=round] (.25,0) -- ++(-.15,-.15);
},
font={\small}%
}%

%-- block diagrams

\tikzset{
  summing junction/.style={
    circle,
    draw=black,
    % fill=FlowChartBlue,
    minimum size=.4cm,
    path picture={
      \draw [black]
        (path picture bounding box.135) -- (path picture bounding box.315)
        (path picture bounding box.45) -- (path picture bounding box.225);
    }
  }
}

%-- mechanical schematics

\tikzstyle{spring}=
  [
    % double,
    thick,
    decorate,
    decoration={coil,pre length=0.5cm,post length=0.5cm,segment length=6,amplitude=6}
  ]
\tikzstyle{damper}=
  [
    thick,
    decoration=
      {
        markings,
        mark connection node=dmp,
        mark=at position 0.5 with
        {
          \node (dmp) [thick,inner sep=0pt,transform shape,rotate=-90,minimum width=15pt,minimum height=3pt,draw=none] {};
          \draw [thick] ($(dmp.north east)+(2pt,0)$) -- (dmp.south east) -- (dmp.south west) -- ($(dmp.north west)+(2pt,0)$);
          \draw [thick] ($(dmp.north)+(0,-5pt)$) -- ($(dmp.north)+(0,5pt)$);
        }
      },
    decorate
  ]

\tikzstyle{damperreversed}=
  [
    thick,
    decoration=
      {
        markings,
        mark connection node=dmp,
        mark=at position 0.5 with
        {
          \node (dmp) [thick,inner sep=0pt,transform shape,rotate=-90,minimum width=15pt,minimum height=3pt,draw=none] {};
          \draw [thick] ($(dmp.north west)+(-2pt,0)$) -- (dmp.south west) -- (dmp.south east) -- ($(dmp.north east)+(-2pt,0)$);
          \draw [thick] ($(dmp.north)+(0,-5pt)$) -- ($(dmp.north)+(0,5pt)$);
        }
      },
    decorate
  ]

\tikzstyle{dragcup}=
  [
    % double,
    thick,
    decoration=
      {
        markings,
        mark connection node=dmp,
        mark=at position 0.5 with
        {
          \node (dmp) [inner sep=0pt,transform shape,rotate=-90,minimum width=15pt,minimum height=3pt,draw=none] {};
          \draw [thick] ($(dmp.north east)+(4pt,0)$) -- (dmp.south east) -- (dmp.south west) -- ($(dmp.north west)+(4pt,0)$);
          \draw [thick] ($(dmp.north)+(0,-5pt)$) -- ($(dmp.north)+(0,5pt)$);
          \draw[thick] (0,5pt) -- ++(4pt,0);
          \draw[thick] (0,-5pt) -- ++(4pt,0);
        }
      },
    decorate
  ]
\newcommand{\balloffset}{.75\pgflinewidth}
\tikzstyle{bearing}=
  [
    shaft,
    decoration=
      {
        markings,
        mark connection node=dmp,
        mark=at position 0.5 with
        {
          \node (dmp) [rectangle,inner sep=0pt,minimum width=.5cm,minimum height=.2cm] {};
          \draw ($(dmp)+(-.33,-.27)$) coordinate (g1) -- ($(dmp)+(.33,-.27)$) coordinate (g2); 
          \draw[fill,pattern=north east lines,draw=none,] (g1) rectangle ($(g2)+(0,-.11)$);
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=south] at ($(dmp.north)+(0,-\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=south] at ($(dmp.north)+(-.08,-\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=south] at ($(dmp.north)+(-.08*2,-\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=south] at ($(dmp.north)+(.08,-\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=south] at ($(dmp.north)+(.08*2,-\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=north] at ($(dmp.south)+(0,\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=north] at ($(dmp.south)+(-.08,\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=north] at ($(dmp.south)+(-.08*2,\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=north] at ($(dmp.south)+(.08,\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=north] at ($(dmp.south)+(.08*2,\balloffset)$) {};
          \node[rectangle,draw,inner sep=0pt,outer sep=0pt,minimum width=.5cm,minimum height=.08cm,fill,pattern=north east lines] at ($(dmp.north)+(0,.12)$) {};
          \node[rectangle,draw,inner sep=0pt,outer sep=0pt,minimum width=.5cm,minimum height=.08cm,fill,pattern=north east lines] at ($(dmp.south)+(0,-.12)$) {};
          \draw[shaft] (-.29cm,0) -- (.29cm,0);
        }
      },
    decorate
  ]
\tikzstyle{bearingreversed}=
  [
    shaft,
    decoration=
      {
        markings,
        mark connection node=dmp,
        mark=at position 0.5 with
        {
          \begin{scope}[xscale=-1,yscale=-1]
          \node (dmp) [rectangle,inner sep=0pt,minimum width=.5cm,minimum height=.2cm] {};
          \draw ($(dmp)+(.33,-.27)$) coordinate (g1) -- ($(dmp)+(-.33,-.27)$) coordinate (g2); 
          \draw[fill,pattern=north east lines,draw=none,] (g1) rectangle ($(g2)+(0,-.11)$);
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=south] at ($(dmp.north)+(0,-\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=south] at ($(dmp.north)+(-.08,-\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=south] at ($(dmp.north)+(-.08*2,-\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=south] at ($(dmp.north)+(.08,-\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=south] at ($(dmp.north)+(.08*2,-\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=north] at ($(dmp.south)+(0,\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=north] at ($(dmp.south)+(-.08,\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=north] at ($(dmp.south)+(-.08*2,\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=north] at ($(dmp.south)+(.08,\balloffset)$) {};
          \node[circle,draw,inner sep=0pt,text width=.08cm,anchor=north] at ($(dmp.south)+(.08*2,\balloffset)$) {};
          \node[rectangle,draw,inner sep=0pt,outer sep=0pt,minimum width=.5cm,minimum height=.08cm,fill,pattern=north east lines] at ($(dmp.north)+(0,.12)$) {};
          \node[rectangle,draw,inner sep=0pt,outer sep=0pt,minimum width=.5cm,minimum height=.08cm,fill,pattern=north east lines] at ($(dmp.south)+(0,-.12)$) {};
          \draw[shaft] (.29cm,0) -- (-.29cm,0);
          \end{scope}
        }
      },
    decorate
  ]
\tikzstyle{shaft}=
  [
    thick,double,double distance=4pt
  ]
\tikzstyle{shaftcap}=
  [
    thick,double,double distance=4pt,line cap=rect,shorten >=2pt,shorten <=2pt
  ]
% I think I could get a start/finish cap by decorating the end with a line ... have to use normal line cap (butt)
% \tikzstyle{shaftcapstart}=
%   [
%     thick,double,double distance=4pt,line cap=rect,shorten >=2pt,shorten <=2pt
%   ]
\tikzstyle{inertia}=
  [
    rectangle,draw,thick,minimum width=.5cm,minimum height=1.5cm,rounded corners=.5pt
  ]
\newcommand{\AxisRotator}[1][rotate=0]{%
    \tikz [x=0.2cm,y=0.4cm,thick,-stealth,#1]
    \draw[line cap=round,inner sep=0pt,outer sep=0pt] (0,0) arc (330:30:1 and 1) node[midway,rectangle,draw,minimum width=.55cm,minimum height=.2cm,color=black,fill=white,anchor=west,xshift=-2pt,thin]{};%
}

%-- transducer elements

% \tikzstyle{motor_right}=
%   [
%     shaft,
%     decoration=
%       {
%         markings,
%         mark connection node=body,
%         mark=at position 0 with
%         {
%           % \node (dmp) [rectangle,inner sep=0pt,minimum width=.5cm,minimum height=.2cm] {};
%           \node (body) [rectangle,draw,thick,inner sep=0pt,minimum width=1.45cm,minimum height=.5cm,rounded corners=1pt] {motor};
%           \draw[thick,line cap=round,rounded corners=.5pt] ($(body.south west)+(.05,0)$) -- ++(-.05,-.05) coordinate (g1west)
%           -- ($(body.south east)+(0,-.05)$)  coordinate (g1east)
%           -- ($(body.south east)+(-.05,0)$);
%           \draw[fill,pattern=north east lines,draw=none,] (g1east) rectangle ($(g1west)+(0,-.11)$);
%           % \draw ($(dmp)+(-.33,-.27)$) coordinate (g1) -- ($(dmp)+(.33,-.27)$) coordinate (g2); 
%           % \draw[fill,pattern=north east lines,draw=none,] (g1) rectangle ($(g2)+(0,-.11)$);
%           % \node[rectangle,draw,inner sep=0pt,outer sep=0pt,minimum width=.5cm,minimum height=.08cm,fill,pattern=north east lines] at ($(dmp.north)+(0,.12)$) {};
%           % \node[rectangle,draw,inner sep=0pt,outer sep=0pt,minimum width=.5cm,minimum height=.08cm,fill,pattern=north east lines] at ($(dmp.south)+(0,-.12)$) {};
%           % \draw[shaft] (-.29cm,0) -- (.29cm,0);
%         }
%       },
%     decorate
%   ]

\tikzset{
  motor/.pic={%
    \node[rectangle,draw,thick,inner sep=0pt,minimum width=1.33cm,minimum height=.5cm,rounded corners=1pt] (-body) at (0,0) {motor};
    \draw[thick,line cap=round,rounded corners=.5pt] ($(-body.south west)+(.05,0)$) -- ++(-.05,-.05) coordinate (g1west)
    -- ($(-body.south east)+(0,-.05)$)  coordinate (g1east)
    -- ($(-body.south east)+(-.05,0)$);
    \draw[fill,pattern=north east lines,draw=none,] (g1east) rectangle ($(g1west)+(0,-.11)$);
    \draw[red] ($(-body.north)+(-.035,0)$) -- ++(0,.2) node[inner sep=1pt,anchor=east] {\scriptsize\bfseries $+$};
    \draw[] ($(-body.north)+(.035,0)$) -- ++(0,.2) node[inner sep=1pt,anchor=west] {\scriptsize\bfseries $-$};
  },
}

%- eye symbol

\newcommand{\eye}[1]{
  \begin{tikzpicture}[scale=#1]
    \pgfmathsetmacro{\ex}{0}
    \pgfmathsetmacro{\ey}{1}
    \draw[thick,line cap=round] (\ex,\ey) -- ++(-25:1)
          (\ex,\ey) -- ++(25:1);
    \draw[thick,line cap=round] (\ex,\ey) ++(45:.8) arc (45:-45:.8);
  \end{tikzpicture}
}